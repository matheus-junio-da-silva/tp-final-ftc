<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste Robusto - Alquimia Autom√°tica</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background: #1a0033;
            color: #e6ccff;
            padding: 20px;
            margin: 0;
        }
        
        .test-container {
            max-width: 1200px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 10px;
        }
        
        .test-section {
            margin: 20px 0;
            padding: 15px;
            background: rgba(102, 126, 234, 0.1);
            border-radius: 8px;
            border-left: 4px solid #667eea;
        }
        
        .test-section.error {
            background: rgba(231, 76, 60, 0.1);
            border-left: 4px solid #e74c3c;
        }
        
        .test-section.success {
            background: rgba(46, 204, 113, 0.1);
            border-left: 4px solid #2ecc71;
        }
        
        .test-button {
            background: #667eea;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
            font-size: 14px;
        }
        
        .test-button:hover {
            background: #5a6fd8;
        }
        
        .test-button:disabled {
            background: #666;
            cursor: not-allowed;
        }
        
        .test-result {
            margin: 10px 0;
            padding: 8px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
        }
        
        .status-ok { color: #2ecc71; }
        .status-error { color: #e74c3c; }
        .status-warning { color: #f1c40f; }
        
        #test-log {
            height: 300px;
            overflow-y: auto;
            background: rgba(0, 0, 0, 0.5);
            padding: 10px;
            border-radius: 5px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            white-space: pre-wrap;
        }
        
        .app-frame {
            width: 100%;
            height: 600px;
            border: 2px solid #667eea;
            border-radius: 5px;
            margin: 20px 0;
        }
        
        .test-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        
        @media (max-width: 768px) {
            .test-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>üß™ Teste Robusto - Alquimia Autom√°tica</h1>
        <p>Sistema completo de testes para verificar todas as funcionalidades da aplica√ß√£o.</p>
        
        <div class="test-grid">
            <div>
                <div class="test-section">
                    <h3>üîß Testes B√°sicos</h3>
                    <button class="test-button" onclick="testBasicElements()">Testar Elementos B√°sicos</button>
                    <button class="test-button" onclick="testScriptLoading()">Testar Carregamento de Scripts</button>
                    <button class="test-button" onclick="testInitialization()">Testar Inicializa√ß√£o</button>
                    <div id="basic-results" class="test-result"></div>
                </div>
                
                <div class="test-section">
                    <h3>üéÆ Testes de Navega√ß√£o</h3>
                    <button class="test-button" onclick="testNavigation()">Testar Menu Principal</button>
                    <button class="test-button" onclick="testScreens()">Testar Troca de Telas</button>
                    <button class="test-button" onclick="testExitButton()">Testar Bot√£o Sair</button>
                    <div id="navigation-results" class="test-result"></div>
                </div>
                
                <div class="test-section">
                    <h3>üîÆ Testes da M√°quina de Mealy</h3>
                    <button class="test-button" onclick="testMealyAccess()">Testar Acesso √† Mealy</button>
                    <button class="test-button" onclick="testMealyInitialization()">Testar Inicializa√ß√£o Mealy</button>
                    <button class="test-button" onclick="testMealyIngredients()">Testar Ingredientes</button>
                    <button class="test-button" onclick="testMealyButtons()">Testar Bot√µes Informativos</button>
                    <button class="test-button" onclick="testMealyRecipes()">Testar Receitas</button>
                    <div id="mealy-results" class="test-result"></div>
                </div>
                
                <div class="test-section">
                    <h3>üîä Testes de Audio</h3>
                    <button class="test-button" onclick="testSoundSystem()">Testar Sistema de Som</button>
                    <button class="test-button" onclick="testSoundFunctions()">Testar Fun√ß√µes de Som</button>
                    <div id="sound-results" class="test-result"></div>
                </div>
                
                <div class="test-section">
                    <h3>üìä Testes Avan√ßados</h3>
                    <button class="test-button" onclick="testMealySequences()">Testar Sequ√™ncias Completas</button>
                    <button class="test-button" onclick="testErrorHandling()">Testar Tratamento de Erros</button>
                    <button class="test-button" onclick="testValidation()">Testar Valida√ß√µes</button>
                    <div id="advanced-results" class="test-result"></div>
                </div>
                
                <div class="test-section">
                    <h3>üöÄ Teste Completo</h3>
                    <button class="test-button" onclick="runFullTest()" style="background: #2ecc71; font-weight: bold;">Executar Teste Completo</button>
                    <button class="test-button" onclick="clearLog()">Limpar Log</button>
                    <div id="full-test-results" class="test-result"></div>
                </div>
            </div>
            
            <div>
                <div class="test-section">
                    <h3>üìã Log de Testes</h3>
                    <div id="test-log"></div>
                </div>
            </div>
        </div>
        
        <div class="test-section">
            <h3>üñ•Ô∏è Aplica√ß√£o Integrada</h3>
            <p>Frame da aplica√ß√£o para testes visuais:</p>
            <iframe src="index.html" class="app-frame" id="app-frame"></iframe>
        </div>
    </div>

    <script>
        // Sistema de Log
        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const logElement = document.getElementById('test-log');
            const typeClass = type === 'error' ? 'status-error' : 
                             type === 'success' ? 'status-ok' : 
                             type === 'warning' ? 'status-warning' : '';
            
            logElement.innerHTML += `<span class="${typeClass}">[${timestamp}] ${message}</span>\n`;
            logElement.scrollTop = logElement.scrollHeight;
        }
        
        function clearLog() {
            document.getElementById('test-log').innerHTML = '';
            log('Log limpo', 'info');
        }
        
        // Fun√ß√£o auxiliar para testar se um elemento existe
        function testElement(selector, name) {
            const element = document.querySelector(selector);
            const exists = element !== null;
            log(`${name}: ${exists ? '‚úÖ Encontrado' : '‚ùå N√£o encontrado'}`, exists ? 'success' : 'error');
            return exists;
        }
        
        // Fun√ß√£o auxiliar para testar fun√ß√£o JavaScript
        function testFunction(functionName) {
            const exists = typeof window[functionName] === 'function';
            log(`Fun√ß√£o ${functionName}: ${exists ? '‚úÖ Existe' : '‚ùå N√£o existe'}`, exists ? 'success' : 'error');
            return exists;
        }
        
        // Fun√ß√£o auxiliar para testar classe
        function testClass(className) {
            const exists = typeof window[className] === 'function';
            log(`Classe ${className}: ${exists ? '‚úÖ Existe' : '‚ùå N√£o existe'}`, exists ? 'success' : 'error');
            return exists;
        }
        
        // 1. Testes B√°sicos
        function testBasicElements() {
            log('=== INICIANDO TESTES B√ÅSICOS ===', 'info');
            const iframe = document.getElementById('app-frame');
            const iframeDoc = iframe.contentDocument || iframe.contentWindow.document;
            
            // Testar elementos b√°sicos do HTML
            const tests = [
                { selector: 'body', name: 'Body' },
                { selector: '#title-screen', name: 'Tela Inicial' },
                { selector: '#main-menu', name: 'Menu Principal' },
                { selector: '#mealy-machine', name: 'Tela M√°quina de Mealy' },
                { selector: '#start-btn', name: 'Bot√£o Come√ßar' },
                { selector: '#mealy-btn', name: 'Bot√£o Mealy' },
                { selector: '#exit-btn', name: 'Bot√£o Sair' },
                { selector: '#mealy-ingredient-input', name: 'Input Ingrediente Mealy' },
                { selector: '#mealy-add-btn', name: 'Bot√£o Adicionar Mealy' }
            ];
            
            let passed = 0;
            tests.forEach(test => {
                const element = iframeDoc.querySelector(test.selector);
                if (element) {
                    log(`‚úÖ ${test.name} encontrado`, 'success');
                    passed++;
                } else {
                    log(`‚ùå ${test.name} N√ÉO encontrado`, 'error');
                }
            });
            
            log(`Resultado: ${passed}/${tests.length} elementos encontrados`, passed === tests.length ? 'success' : 'error');
            document.getElementById('basic-results').innerHTML = `${passed}/${tests.length} elementos OK`;
        }
        
        function testScriptLoading() {
            log('=== TESTANDO CARREGAMENTO DE SCRIPTS ===', 'info');
            const iframe = document.getElementById('app-frame');
            const iframeWindow = iframe.contentWindow;
            
            const scripts = [
                'AlquimiaApp',
                'Mealy', 
                'Alfabeto',
                'Terminal',
                'SoundManager'
            ];
            
            let passed = 0;
            scripts.forEach(script => {
                if (typeof iframeWindow[script] !== 'undefined') {
                    log(`‚úÖ ${script} carregado`, 'success');
                    passed++;
                } else {
                    log(`‚ùå ${script} N√ÉO carregado`, 'error');
                }
            });
            
            log(`Scripts: ${passed}/${scripts.length} carregados`, passed === scripts.length ? 'success' : 'error');
        }
        
        function testInitialization() {
            log('=== TESTANDO INICIALIZA√á√ÉO ===', 'info');
            const iframe = document.getElementById('app-frame');
            const iframeWindow = iframe.contentWindow;
            
            // Verificar se a aplica√ß√£o foi inicializada
            if (iframeWindow.app) {
                log('‚úÖ Aplica√ß√£o inicializada', 'success');
                
                // Testar propriedades da aplica√ß√£o
                const props = ['alfabeto', 'soundManager', 'currentScreen'];
                props.forEach(prop => {
                    if (iframeWindow.app[prop]) {
                        log(`‚úÖ app.${prop} existe`, 'success');
                    } else {
                        log(`‚ùå app.${prop} n√£o existe`, 'error');
                    }
                });
            } else {
                log('‚ùå Aplica√ß√£o N√ÉO inicializada', 'error');
            }
        }
        
        // 2. Testes de Navega√ß√£o
        function testNavigation() {
            log('=== TESTANDO NAVEGA√á√ÉO ===', 'info');
            const iframe = document.getElementById('app-frame');
            const iframeDoc = iframe.contentDocument || iframe.contentWindow.document;
            
            // Simular clique no bot√£o come√ßar
            const startBtn = iframeDoc.getElementById('start-btn');
            if (startBtn) {
                log('Simulando clique em "Come√ßar Aventura"...', 'info');
                startBtn.click();
                
                setTimeout(() => {
                    const mainMenu = iframeDoc.getElementById('main-menu');
                    if (mainMenu && mainMenu.classList.contains('active')) {
                        log('‚úÖ Menu principal aberto com sucesso', 'success');
                    } else {
                        log('‚ùå Menu principal N√ÉO abriu', 'error');
                    }
                }, 500);
            } else {
                log('‚ùå Bot√£o "Come√ßar" n√£o encontrado', 'error');
            }
        }
        
        function testScreens() {
            log('=== TESTANDO TROCA DE TELAS ===', 'info');
            const iframe = document.getElementById('app-frame');
            const iframeDoc = iframe.contentDocument || iframe.contentWindow.document;
            
            const screens = [
                { id: 'title-screen', name: 'Tela Inicial' },
                { id: 'main-menu', name: 'Menu Principal' },
                { id: 'mealy-machine', name: 'M√°quina de Mealy' },
                { id: 'result-screen', name: 'Tela de Resultado' }
            ];
            
            screens.forEach(screen => {
                const element = iframeDoc.getElementById(screen.id);
                if (element) {
                    log(`‚úÖ ${screen.name} existe`, 'success');
                } else {
                    log(`‚ùå ${screen.name} n√£o encontrada`, 'error');
                }
            });
        }
        
        function testExitButton() {
            log('=== TESTANDO BOT√ÉO SAIR ===', 'info');
            const iframe = document.getElementById('app-frame');
            const iframeDoc = iframe.contentDocument || iframe.contentWindow.document;
            const iframeWindow = iframe.contentWindow;
            
            // Primeiro ir para o menu principal
            const startBtn = iframeDoc.getElementById('start-btn');
            if (startBtn) {
                startBtn.click();
                
                setTimeout(() => {
                    const exitBtn = iframeDoc.getElementById('exit-btn');
                    if (exitBtn) {
                        log('Bot√£o sair encontrado, testando clique...', 'info');
                        
                        // Verificar se o event listener est√° funcionando
                        exitBtn.click();
                        
                        setTimeout(() => {
                            // Verificar se voltou para a tela inicial
                            const titleScreen = iframeDoc.getElementById('title-screen');
                            if (titleScreen && titleScreen.classList.contains('active')) {
                                log('‚úÖ Bot√£o sair funcionando corretamente', 'success');
                            } else {
                                log('‚ùå Bot√£o sair N√ÉO est√° funcionando', 'error');
                                
                                // Verificar se h√° algum erro no console
                                log('Verificando erros no console...', 'warning');
                            }
                        }, 500);
                    } else {
                        log('‚ùå Bot√£o sair n√£o encontrado', 'error');
                    }
                }, 500);
            }
        }
        
        // 3. Testes da M√°quina de Mealy
        function testMealyAccess() {
            log('=== TESTANDO ACESSO √Ä M√ÅQUINA DE MEALY ===', 'info');
            const iframe = document.getElementById('app-frame');
            const iframeDoc = iframe.contentDocument || iframe.contentWindow.document;
            
            // Navegar at√© a m√°quina de Mealy
            const startBtn = iframeDoc.getElementById('start-btn');
            if (startBtn) {
                startBtn.click();
                
                setTimeout(() => {
                    const mealyBtn = iframeDoc.getElementById('mealy-btn');
                    if (mealyBtn) {
                        log('Bot√£o Mealy encontrado, tentando acesso...', 'info');
                        mealyBtn.click();
                        
                        setTimeout(() => {
                            const mealyScreen = iframeDoc.getElementById('mealy-machine');
                            if (mealyScreen && mealyScreen.classList.contains('active')) {
                                log('‚úÖ Acesso √† M√°quina de Mealy funcionando', 'success');
                            } else {
                                log('‚ùå N√ÉO conseguiu acessar M√°quina de Mealy', 'error');
                            }
                        }, 500);
                    } else {
                        log('‚ùå Bot√£o Mealy n√£o encontrado', 'error');
                    }
                }, 500);
            }
        }
        
        function testMealyInitialization() {
            log('=== TESTANDO INICIALIZA√á√ÉO DA M√ÅQUINA DE MEALY ===', 'info');
            const iframe = document.getElementById('app-frame');
            const iframeWindow = iframe.contentWindow;
            
            if (iframeWindow.app && iframeWindow.app.mealy) {
                log('‚úÖ M√°quina de Mealy inicializada', 'success');
                
                const mealy = iframeWindow.app.mealy;
                const props = ['estadoAtual', 'alfabeto', 'estados', 'descricoes'];
                
                props.forEach(prop => {
                    if (mealy[prop]) {
                        log(`‚úÖ mealy.${prop} existe`, 'success');
                    } else {
                        log(`‚ùå mealy.${prop} n√£o existe`, 'error');
                    }
                });
            } else {
                log('‚ùå M√°quina de Mealy N√ÉO inicializada', 'error');
            }
        }
        
        function testMealyIngredients() {
            log('=== TESTANDO INGREDIENTES DA M√ÅQUINA DE MEALY ===', 'info');
            const iframe = document.getElementById('app-frame');
            const iframeDoc = iframe.contentDocument || iframe.contentWindow.document;
            const iframeWindow = iframe.contentWindow;
            
            // Navegar at√© Mealy
            this.navigateToMealy(() => {
                const input = iframeDoc.getElementById('mealy-ingredient-input');
                const addBtn = iframeDoc.getElementById('mealy-add-btn');
                
                if (input && addBtn) {
                    log('Elementos de input encontrados, testando ingredientes...', 'info');
                    
                    const testIngredients = ['biz', 'pip', 'lol', 'xyz'];
                    let currentTest = 0;
                    
                    function testNext() {
                        if (currentTest >= testIngredients.length) {
                            log('Teste de ingredientes conclu√≠do', 'info');
                            return;
                        }
                        
                        const ingredient = testIngredients[currentTest];
                        log(`Testando ingrediente: ${ingredient}`, 'info');
                        
                        input.value = ingredient;
                        addBtn.click();
                        
                        setTimeout(() => {
                            // Verificar se houve mudan√ßa no estado
                            if (iframeWindow.app && iframeWindow.app.mealy) {
                                const estado = iframeWindow.app.mealy.obterEstado();
                                log(`Resultado ${ingredient}: Estado=${estado.estadoAtual}, Ingredientes=${estado.ingredientes}`, 
                                    estado.ingredientes > currentTest ? 'success' : 'warning');
                            }
                            
                            currentTest++;
                            testNext();
                        }, 1000);
                    }
                    
                    testNext();
                } else {
                    log('‚ùå Elementos de input n√£o encontrados', 'error');
                }
            });
        }
        
        function testMealyButtons() {
            log('=== TESTANDO BOT√ïES INFORMATIVOS DA MEALY ===', 'info');
            const iframe = document.getElementById('app-frame');
            const iframeDoc = iframe.contentDocument || iframe.contentWindow.document;
            
            this.navigateToMealy(() => {
                const buttons = [
                    { id: 'view-mealy-machine-btn', name: 'Ver M√°quina' },
                    { id: 'view-mealy-effects-btn', name: 'Ver Efeitos' },
                    { id: 'view-mealy-alphabet-btn', name: 'Ver Alfabeto' },
                    { id: 'view-mealy-recipes-btn', name: 'Ver Receitas' }
                ];
                
                buttons.forEach(button => {
                    const element = iframeDoc.getElementById(button.id);
                    if (element) {
                        log(`‚úÖ Bot√£o "${button.name}" encontrado`, 'success');
                        
                        // Testar clique
                        element.click();
                        setTimeout(() => {
                            const modal = iframeDoc.getElementById('info-modal');
                            if (modal && modal.style.display !== 'none') {
                                log(`‚úÖ Modal "${button.name}" abriu`, 'success');
                                
                                // Fechar modal
                                const closeBtn = iframeDoc.querySelector('.close');
                                if (closeBtn) closeBtn.click();
                            } else {
                                log(`‚ùå Modal "${button.name}" N√ÉO abriu`, 'error');
                            }
                        }, 500);
                    } else {
                        log(`‚ùå Bot√£o "${button.name}" n√£o encontrado`, 'error');
                    }
                });
            });
        }
        
        function testMealyRecipes() {
            log('=== TESTANDO RECEITAS DA MEALY ===', 'info');
            const iframe = document.getElementById('app-frame');
            const iframeDoc = iframe.contentDocument || iframe.contentWindow.document;
            
            this.navigateToMealy(() => {
                const recipesBtn = iframeDoc.getElementById('view-mealy-recipes-btn');
                if (recipesBtn) {
                    log('Testando bot√£o "Ver Receitas"...', 'info');
                    recipesBtn.click();
                    
                    setTimeout(() => {
                        const modal = iframeDoc.getElementById('info-modal');
                        const modalBody = iframeDoc.getElementById('modal-body');
                        
                        if (modal && modal.style.display !== 'none' && modalBody) {
                            log('‚úÖ Modal de receitas abriu', 'success');
                            
                            // Verificar se tem receitas
                            const recipes = modalBody.querySelectorAll('.recipe-section');
                            if (recipes.length > 0) {
                                log(`‚úÖ ${recipes.length} receitas encontradas`, 'success');
                            } else {
                                log('‚ùå Nenhuma receita encontrada', 'error');
                            }
                        } else {
                            log('‚ùå Modal de receitas N√ÉO abriu', 'error');
                        }
                    }, 500);
                } else {
                    log('‚ùå Bot√£o "Ver Receitas" n√£o encontrado', 'error');
                }
            });
        }
        
        // 4. Testes de Audio
        function testSoundSystem() {
            log('=== TESTANDO SISTEMA DE SOM ===', 'info');
            const iframe = document.getElementById('app-frame');
            const iframeWindow = iframe.contentWindow;
            
            if (iframeWindow.SoundManager) {
                log('‚úÖ Classe SoundManager existe', 'success');
                
                const soundFunctions = [
                    'soundAddIngrediente',
                    'soundGameOver',
                    'soundOraculo',
                    'soundOraculoWin'
                ];
                
                soundFunctions.forEach(func => {
                    if (typeof iframeWindow[func] === 'function') {
                        log(`‚úÖ Fun√ß√£o ${func} existe`, 'success');
                    } else {
                        log(`‚ùå Fun√ß√£o ${func} n√£o existe`, 'error');
                    }
                });
            } else {
                log('‚ùå Sistema de som n√£o carregado', 'error');
            }
        }
        
        function testSoundFunctions() {
            log('=== TESTANDO FUN√á√ïES DE SOM ===', 'info');
            const iframe = document.getElementById('app-frame');
            const iframeWindow = iframe.contentWindow;
            
            if (typeof iframeWindow.soundAddIngrediente === 'function') {
                try {
                    iframeWindow.soundAddIngrediente();
                    log('‚úÖ Som de ingrediente tocado', 'success');
                } catch (error) {
                    log(`‚ùå Erro ao tocar som: ${error.message}`, 'error');
                }
            }
        }
        
        // 5. Testes Avan√ßados
        function testMealySequences() {
            log('=== TESTANDO SEQU√äNCIAS COMPLETAS ===', 'info');
            
            // Testar receita saborosa: pip ‚Üí bur ‚Üí p ‚Üí pix
            this.navigateToMealy(() => {
                this.testRecipeSequence(['pip', 'bur', 'p', 'pix'], 'Receita Saborosa');
            });
        }
        
        function testErrorHandling() {
            log('=== TESTANDO TRATAMENTO DE ERROS ===', 'info');
            
            this.navigateToMealy(() => {
                const iframe = document.getElementById('app-frame');
                const iframeDoc = iframe.contentDocument || iframe.contentWindow.document;
                
                const input = iframeDoc.getElementById('mealy-ingredient-input');
                const addBtn = iframeDoc.getElementById('mealy-add-btn');
                
                if (input && addBtn) {
                    // Testar ingrediente inv√°lido
                    log('Testando ingrediente inv√°lido...', 'info');
                    input.value = 'xyz';
                    addBtn.click();
                    
                    setTimeout(() => {
                        log('Teste de erro conclu√≠do', 'info');
                    }, 1000);
                }
            });
        }
        
        function testValidation() {
            log('=== TESTANDO VALIDA√á√ïES ===', 'info');
            const iframe = document.getElementById('app-frame');
            const iframeWindow = iframe.contentWindow;
            
            if (iframeWindow.app && iframeWindow.app.alfabeto) {
                const alfabeto = iframeWindow.app.alfabeto;
                
                const testCases = [
                    { ingredient: 'biz', expected: true },
                    { ingredient: 'pip', expected: true },
                    { ingredient: 'xyz', expected: false },
                    { ingredient: '', expected: false }
                ];
                
                testCases.forEach(test => {
                    const result = alfabeto.validaIngrediente(test.ingredient);
                    const passed = result === test.expected;
                    log(`Valida√ß√£o "${test.ingredient}": ${passed ? '‚úÖ' : '‚ùå'} (esperado: ${test.expected}, obtido: ${result})`, 
                        passed ? 'success' : 'error');
                });
            } else {
                log('‚ùå Alfabeto n√£o dispon√≠vel para teste', 'error');
            }
        }
        
        // Fun√ß√£o auxiliar para navegar at√© Mealy
        function navigateToMealy(callback) {
            const iframe = document.getElementById('app-frame');
            const iframeDoc = iframe.contentDocument || iframe.contentWindow.document;
            
            const startBtn = iframeDoc.getElementById('start-btn');
            if (startBtn) {
                startBtn.click();
                
                setTimeout(() => {
                    const mealyBtn = iframeDoc.getElementById('mealy-btn');
                    if (mealyBtn) {
                        mealyBtn.click();
                        
                        setTimeout(() => {
                            callback();
                        }, 500);
                    }
                }, 500);
            }
        }
        
        // Fun√ß√£o auxiliar para testar sequ√™ncia de receita
        function testRecipeSequence(ingredients, recipeName) {
            const iframe = document.getElementById('app-frame');
            const iframeDoc = iframe.contentDocument || iframe.contentWindow.document;
            const iframeWindow = iframe.contentWindow;
            
            log(`Testando ${recipeName}: ${ingredients.join(' ‚Üí ')}`, 'info');
            
            const input = iframeDoc.getElementById('mealy-ingredient-input');
            const addBtn = iframeDoc.getElementById('mealy-add-btn');
            
            if (input && addBtn) {
                let currentIndex = 0;
                
                function addNext() {
                    if (currentIndex >= ingredients.length) {
                        // Finalizar teste
                        const finishBtn = iframeDoc.getElementById('mealy-finish-btn');
                        if (finishBtn && finishBtn.style.display !== 'none') {
                            finishBtn.click();
                            log(`‚úÖ ${recipeName} testada com sucesso`, 'success');
                        }
                        return;
                    }
                    
                    const ingredient = ingredients[currentIndex];
                    input.value = ingredient;
                    addBtn.click();
                    
                    setTimeout(() => {
                        if (iframeWindow.app && iframeWindow.app.mealy) {
                            const estado = iframeWindow.app.mealy.obterEstado();
                            log(`Adicionado ${ingredient}: Estado=${estado.estadoAtual}`, 'info');
                        }
                        
                        currentIndex++;
                        addNext();
                    }, 1000);
                }
                
                addNext();
            }
        }
        
        // Teste Completo
        function runFullTest() {
            log('üöÄ INICIANDO TESTE COMPLETO üöÄ', 'info');
            document.getElementById('full-test-results').innerHTML = 'Executando...';
            
            const tests = [
                testBasicElements,
                testScriptLoading,
                testInitialization,
                testNavigation,
                testScreens,
                testExitButton,
                testMealyAccess,
                testSoundSystem
            ];
            
            let currentTest = 0;
            
            function runNext() {
                if (currentTest >= tests.length) {
                    log('üéâ TESTE COMPLETO FINALIZADO üéâ', 'success');
                    document.getElementById('full-test-results').innerHTML = 'Teste completo finalizado!';
                    return;
                }
                
                try {
                    tests[currentTest]();
                    currentTest++;
                    setTimeout(runNext, 2000);
                } catch (error) {
                    log(`‚ùå Erro no teste: ${error.message}`, 'error');
                    currentTest++;
                    setTimeout(runNext, 1000);
                }
            }
            
            runNext();
        }
        
        // Inicializar
        window.addEventListener('load', () => {
            log('Sistema de testes inicializado', 'success');
            log('Clique nos bot√µes para executar testes espec√≠ficos', 'info');
        });
    </script>
</body>
</html>
